# AIå·¥ä½œæµç¼–æ’ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 é¡¹ç›®å®šä½
æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ª**åŸºäºSpringBoot+MCP+æµç¨‹å¼•æ“çš„å¤šAgentç¼–æ’ç³»ç»Ÿ**ï¼Œç±»ä¼¼Difyä½†æ ¸å¿ƒå·®å¼‚åŒ–åœ¨äºæ”¯æŒMCPï¼ˆModel Context Protocolï¼‰åè®®ï¼Œä¸ºä¼ä¸šæä¾›æ ‡å‡†åŒ–çš„AIå·¥ä½œæµç¼–æ’èƒ½åŠ›ã€‚

### 1.2 æ ¸å¿ƒä»·å€¼
- ğŸ¯ **MCPåè®®æ”¯æŒ**ï¼šæ ‡å‡†åŒ–AIæ¨¡å‹äº¤äº’ï¼Œæ”¯æŒé˜¿é‡Œé€šä¹‰åƒé—®ç­‰å›½å†…MCPæ¨¡å‹
- âš™ï¸ **è‡ªç ”æµç¨‹å¼•æ“**ï¼šå¯è§†åŒ–æµç¨‹è®¾è®¡ï¼Œå¤šAgentåä½œç¼–æ’
- ğŸš€ **ä¼ä¸šçº§éƒ¨ç½²**ï¼šé«˜å¯ç”¨ã€å¯æ‰©å±•çš„ç”Ÿäº§ç¯å¢ƒæ”¯æŒ
- ğŸ”— **å¼€æ”¾ç”Ÿæ€**ï¼šæ ‡å‡†åŒ–æ¥å£ï¼Œæ˜“äºé›†æˆç¬¬ä¸‰æ–¹å·¥å…·å’ŒæœåŠ¡

### 1.3 æŠ€æœ¯æ ˆ
- **åç«¯æ¡†æ¶**ï¼šSpring Boot 3.5+, Java 17
- **åè®®æ ‡å‡†**ï¼šMCP (Model Context Protocol) 
- **æ•°æ®å­˜å‚¨**ï¼šMySQL 8.0+, Redis 7.0+
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šRedis Stream / RabbitMQ
- **å®¹å™¨åŒ–**ï¼šDocker + Kubernetes

---

## 2. ç³»ç»Ÿæ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·æ¥å…¥å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Webç®¡ç†ç•Œé¢    â”‚   REST API      â”‚   WebSocketå®æ—¶é€šä¿¡      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç½‘å…³å±‚                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   API Gateway   â”‚   è®¤è¯æˆæƒ       â”‚   é™æµç†”æ–­              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ ¸å¿ƒä¸šåŠ¡å±‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”— MCPåè®®å¼•æ“  â”‚  âš™ï¸ æµç¨‹ç¼–æ’å¼•æ“ â”‚   Agentç®¡ç†å™¨           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ•°æ®å­˜å‚¨å±‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   MySQLä¸»åº“     â”‚   Redisç¼“å­˜     â”‚   æ–‡ä»¶å­˜å‚¨              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  AIæ¨¡å‹å±‚                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é˜¿é‡Œé€šä¹‰åƒé—®    â”‚   ç™¾åº¦æ–‡å¿ƒ      â”‚   å…¶ä»–MCPæ¨¡å‹           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒæ¨¡å—æ¶æ„

#### 2.2.1 MCPåè®®å¼•æ“æ¨¡å—
```
MCPå¼•æ“
â”œâ”€â”€ MCPæœåŠ¡å™¨ (MCPServer)
â”‚   â”œâ”€â”€ åè®®å¤„ç†å™¨ (ProtocolHandler)
â”‚   â”œâ”€â”€ è¿æ¥ç®¡ç†å™¨ (ConnectionManager) 
â”‚   â””â”€â”€ æ¶ˆæ¯è·¯ç”±å™¨ (MessageRouter)
â”œâ”€â”€ MCPå®¢æˆ·ç«¯ (MCPClient)
â”‚   â”œâ”€â”€ æ¨¡å‹è¿æ¥æ±  (ModelConnectionPool)
â”‚   â”œâ”€â”€ è¯·æ±‚ç®¡ç†å™¨ (RequestManager)
â”‚   â””â”€â”€ å“åº”å¤„ç†å™¨ (ResponseHandler)
â””â”€â”€ å·¥å…·ç®¡ç†å™¨ (ToolManager)
    â”œâ”€â”€ å·¥å…·æ³¨å†Œä¸­å¿ƒ (ToolRegistry)
    â”œâ”€â”€ æƒé™æ§åˆ¶å™¨ (PermissionController)
    â””â”€â”€ èµ„æºç®¡ç†å™¨ (ResourceManager)
```

#### 2.2.2 æµç¨‹ç¼–æ’å¼•æ“æ¨¡å—
```
æµç¨‹å¼•æ“
â”œâ”€â”€ æµç¨‹è®¾è®¡å™¨ (ProcessDesigner)
â”‚   â”œâ”€â”€ BPMNè§£æå™¨ (BPMNParser)
â”‚   â”œâ”€â”€ æµç¨‹éªŒè¯å™¨ (ProcessValidator)
â”‚   â””â”€â”€ æ¨¡æ¿ç®¡ç†å™¨ (TemplateManager)
â”œâ”€â”€ æµç¨‹æ‰§è¡Œå™¨ (ProcessExecutor)
â”‚   â”œâ”€â”€ ä»»åŠ¡è°ƒåº¦å™¨ (TaskScheduler)
â”‚   â”œâ”€â”€ çŠ¶æ€ç®¡ç†å™¨ (StateManager)
â”‚   â””â”€â”€ äº‹ä»¶å¤„ç†å™¨ (EventHandler)
â””â”€â”€ Agentç®¡ç†å™¨ (AgentManager)
    â”œâ”€â”€ Agentæ³¨å†Œä¸­å¿ƒ (AgentRegistry)
    â”œâ”€â”€ è´Ÿè½½å‡è¡¡å™¨ (LoadBalancer)
    â””â”€â”€ å¥åº·æ£€æŸ¥å™¨ (HealthChecker)
```

---

## 3. æ ¸å¿ƒæ¨¡å—è¯¦ç»†è®¾è®¡

### 3.1 MCPåè®®å¼•æ“è®¾è®¡

#### 3.1.1 MCPæœåŠ¡å™¨ (MCPServer)
```java
@Component
@Slf4j
public class MCPServer {
    
    @Autowired
    private ProtocolHandler protocolHandler;
    
    @Autowired
    private ConnectionManager connectionManager;
    
    @Autowired
    private MessageRouter messageRouter;
    
    /**
     * å¯åŠ¨MCPæœåŠ¡å™¨
     */
    public void start() {
        // åˆå§‹åŒ–åè®®å¤„ç†å™¨
        // å¯åŠ¨è¿æ¥ç›‘å¬
        // æ³¨å†Œæ¶ˆæ¯è·¯ç”±
    }
    
    /**
     * å¤„ç†MCPè¯·æ±‚
     */
    public MCPResponse handleRequest(MCPRequest request) {
        // éªŒè¯è¯·æ±‚æ ¼å¼
        // è·¯ç”±åˆ°å¯¹åº”å¤„ç†å™¨
        // è¿”å›æ ‡å‡†å“åº”
    }
}
```

#### 3.1.2 æ¨¡å‹é€‚é…å™¨è®¾è®¡
```java
public interface ModelAdapter {
    
    /**
     * è¿æ¥AIæ¨¡å‹
     */
    MCPConnection connect(ModelConfig config);
    
    /**
     * å‘é€MCPè¯·æ±‚
     */
    MCPResponse sendRequest(MCPRequest request);
    
    /**
     * è°ƒç”¨å·¥å…·
     */
    ToolResponse invokeTool(ToolRequest toolRequest);
    
    /**
     * è®¿é—®èµ„æº
     */
    ResourceResponse accessResource(ResourceRequest resourceRequest);
}

@Component
public class AliTongyiAdapter implements ModelAdapter {
    // é˜¿é‡Œé€šä¹‰åƒé—®MCPé€‚é…å®ç°
}

@Component  
public class BaiduWenxinAdapter implements ModelAdapter {
    // ç™¾åº¦æ–‡å¿ƒä¸€è¨€MCPé€‚é…å®ç°
}
```

### 3.2 æµç¨‹ç¼–æ’å¼•æ“è®¾è®¡

#### 3.2.1 æµç¨‹å®šä¹‰æ¨¡å‹
```java
@Entity
@Table(name = "process_definition")
public class ProcessDefinition {
    
    @Id
    private String processId;
    
    @Column(name = "process_name")
    private String processName;
    
    @Column(name = "bpmn_xml", columnDefinition = "TEXT")
    private String bpmnXml;
    
    @Column(name = "version")
    private Integer version;
    
    @Column(name = "status")
    @Enumerated(EnumType.STRING)
    private ProcessStatus status;
    
    @OneToMany(mappedBy = "processDefinition", cascade = CascadeType.ALL)
    private List<ProcessInstance> instances;
    
    // getter/setter
}
```

#### 3.2.2 ä»»åŠ¡è°ƒåº¦å™¨è®¾è®¡
```java
@Component
@Slf4j
public class TaskScheduler {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Autowired
    private AgentManager agentManager;
    
    /**
     * æäº¤ä»»åŠ¡åˆ°é˜Ÿåˆ—
     */
    public void submitTask(Task task) {
        // ä»»åŠ¡ä¼˜å…ˆçº§æ’åº
        // æ·»åŠ åˆ°Redisé˜Ÿåˆ—
        // è§¦å‘æ‰§è¡Œå™¨
    }
    
    /**
     * æ‰§è¡Œä»»åŠ¡
     */
    @Async("taskExecutor")
    public CompletableFuture<TaskResult> executeTask(Task task) {
        try {
            // é€‰æ‹©åˆé€‚çš„Agent
            Agent agent = agentManager.selectAgent(task);
            
            // æ‰§è¡Œä»»åŠ¡
            TaskResult result = agent.execute(task);
            
            // æ›´æ–°ä»»åŠ¡çŠ¶æ€
            updateTaskStatus(task.getId(), TaskStatus.COMPLETED);
            
            return CompletableFuture.completedFuture(result);
        } catch (Exception e) {
            log.error("ä»»åŠ¡æ‰§è¡Œå¤±è´¥: {}", task.getId(), e);
            updateTaskStatus(task.getId(), TaskStatus.FAILED);
            return CompletableFuture.failedFuture(e);
        }
    }
}
```

### 3.3 Agentç®¡ç†å™¨è®¾è®¡

#### 3.3.1 Agentæ¥å£å®šä¹‰
```java
public interface Agent {
    
    /**
     * Agentå”¯ä¸€æ ‡è¯†
     */
    String getAgentId();
    
    /**
     * Agentèƒ½åŠ›æè¿°
     */
    AgentCapability getCapability();
    
    /**
     * æ‰§è¡Œä»»åŠ¡
     */
    TaskResult execute(Task task);
    
    /**
     * å¥åº·æ£€æŸ¥
     */
    HealthStatus getHealthStatus();
}

@Component
public class LLMAgent implements Agent {
    
    @Autowired
    private MCPClient mcpClient;
    
    @Override
    public TaskResult execute(Task task) {
        // é€šè¿‡MCPè°ƒç”¨AIæ¨¡å‹
        MCPRequest request = buildMCPRequest(task);
        MCPResponse response = mcpClient.sendRequest(request);
        return parseTaskResult(response);
    }
}
```

---

## 4. æ•°æ®åº“è®¾è®¡

### 4.1 æ ¸å¿ƒè¡¨ç»“æ„

#### 4.1.1 æµç¨‹å®šä¹‰è¡¨
```sql
CREATE TABLE process_definition (
    process_id VARCHAR(64) PRIMARY KEY,
    process_name VARCHAR(255) NOT NULL,
    process_key VARCHAR(255) NOT NULL,
    bpmn_xml TEXT,
    version INT DEFAULT 1,
    status ENUM('DRAFT', 'ACTIVE', 'SUSPENDED', 'DELETED') DEFAULT 'DRAFT',
    created_by VARCHAR(64),
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_process_key (process_key),
    INDEX idx_status (status)
);
```

#### 4.1.2 æµç¨‹å®ä¾‹è¡¨
```sql
CREATE TABLE process_instance (
    instance_id VARCHAR(64) PRIMARY KEY,
    process_id VARCHAR(64) NOT NULL,
    business_key VARCHAR(255),
    status ENUM('RUNNING', 'COMPLETED', 'FAILED', 'SUSPENDED') DEFAULT 'RUNNING',
    start_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    end_time TIMESTAMP NULL,
    variables JSON,
    
    FOREIGN KEY (process_id) REFERENCES process_definition(process_id),
    INDEX idx_process_id (process_id),
    INDEX idx_status (status),
    INDEX idx_start_time (start_time)
);
```

#### 4.1.3 ä»»åŠ¡å®ä¾‹è¡¨
```sql
CREATE TABLE task_instance (
    task_id VARCHAR(64) PRIMARY KEY,
    instance_id VARCHAR(64) NOT NULL,
    task_name VARCHAR(255) NOT NULL,
    task_type ENUM('USER_TASK', 'SERVICE_TASK', 'SCRIPT_TASK', 'AGENT_TASK') NOT NULL,
    agent_id VARCHAR(64),
    status ENUM('PENDING', 'RUNNING', 'COMPLETED', 'FAILED', 'SKIPPED') DEFAULT 'PENDING',
    priority INT DEFAULT 0,
    start_time TIMESTAMP NULL,
    end_time TIMESTAMP NULL,
    input_data JSON,
    output_data JSON,
    error_message TEXT,
    
    FOREIGN KEY (instance_id) REFERENCES process_instance(instance_id),
    INDEX idx_instance_id (instance_id),
    INDEX idx_status (status),
    INDEX idx_priority (priority DESC)
);
```

#### 4.1.4 Agentæ³¨å†Œè¡¨
```sql
CREATE TABLE agent_registry (
    agent_id VARCHAR(64) PRIMARY KEY,
    agent_name VARCHAR(255) NOT NULL,
    agent_type ENUM('LLM', 'TOOL', 'CUSTOM') NOT NULL,
    capabilities JSON,
    endpoint_url VARCHAR(500),
    auth_config JSON,
    status ENUM('ACTIVE', 'INACTIVE', 'MAINTENANCE') DEFAULT 'ACTIVE',
    health_status ENUM('HEALTHY', 'UNHEALTHY', 'UNKNOWN') DEFAULT 'UNKNOWN',
    last_heartbeat TIMESTAMP NULL,
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_agent_type (agent_type),
    INDEX idx_status (status),
    INDEX idx_last_heartbeat (last_heartbeat)
);
```

#### 4.1.5 MCPè¿æ¥è¡¨
```sql
CREATE TABLE mcp_connection (
    connection_id VARCHAR(64) PRIMARY KEY,
    model_provider VARCHAR(100) NOT NULL,
    model_name VARCHAR(255) NOT NULL,
    endpoint_url VARCHAR(500) NOT NULL,
    api_key_encrypted VARCHAR(512),
    connection_config JSON,
    status ENUM('CONNECTED', 'DISCONNECTED', 'ERROR') DEFAULT 'DISCONNECTED',
    last_connected TIMESTAMP NULL,
    error_message TEXT,
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_provider (model_provider),
    INDEX idx_status (status)
);
```

### 4.2 Redisæ•°æ®ç»“æ„è®¾è®¡

#### 4.2.1 ä»»åŠ¡é˜Ÿåˆ—
```
# ä¼˜å…ˆçº§ä»»åŠ¡é˜Ÿåˆ—
ai_workflow:task_queue:high     # é«˜ä¼˜å…ˆçº§ä»»åŠ¡
ai_workflow:task_queue:normal   # æ™®é€šä¼˜å…ˆçº§ä»»åŠ¡
ai_workflow:task_queue:low      # ä½ä¼˜å…ˆçº§ä»»åŠ¡

# ä»»åŠ¡çŠ¶æ€ç¼“å­˜
ai_workflow:task_status:{taskId}  # ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€

# Agentè´Ÿè½½ä¿¡æ¯
ai_workflow:agent_load:{agentId}  # Agentå½“å‰è´Ÿè½½
```

#### 4.2.2 ä¼šè¯ç¼“å­˜
```
# MCPè¿æ¥ä¼šè¯
ai_workflow:mcp_session:{connectionId}  # MCPè¿æ¥ä¼šè¯ä¿¡æ¯

# ç”¨æˆ·ä¼šè¯
ai_workflow:user_session:{userId}       # ç”¨æˆ·ä¼šè¯ä¿¡æ¯

# æµç¨‹æ‰§è¡Œä¸Šä¸‹æ–‡
ai_workflow:process_context:{instanceId}  # æµç¨‹æ‰§è¡Œä¸Šä¸‹æ–‡
```

---

## 5. APIæ¥å£è®¾è®¡

### 5.1 æµç¨‹ç®¡ç†API

#### 5.1.1 åˆ›å»ºæµç¨‹å®šä¹‰
```http
POST /api/v1/processes/definitions
Content-Type: application/json

{
  "processName": "å®¢æˆ·æœåŠ¡æµç¨‹",
  "processKey": "customer_service_flow",
  "bpmnXml": "<bpmn2:definitions>...</bpmn2:definitions>",
  "description": "æ™ºèƒ½å®¢æˆ·æœåŠ¡å¤„ç†æµç¨‹"
}

Response 200:
{
  "code": 200,
  "message": "success",
  "data": {
    "processId": "proc_1234567890",
    "version": 1,
    "status": "DRAFT"
  }
}
```

#### 5.1.2 å¯åŠ¨æµç¨‹å®ä¾‹
```http
POST /api/v1/processes/instances
Content-Type: application/json

{
  "processId": "proc_1234567890",
  "businessKey": "order_20240101001",
  "variables": {
    "customerId": "cust_001",
    "orderAmount": 1000.00,
    "priority": "HIGH"
  }
}

Response 200:
{
  "code": 200,
  "message": "success", 
  "data": {
    "instanceId": "inst_1234567890",
    "status": "RUNNING",
    "startTime": "2024-01-01T10:00:00Z"
  }
}
```

### 5.2 Agentç®¡ç†API

#### 5.2.1 æ³¨å†ŒAgent
```http
POST /api/v1/agents/register
Content-Type: application/json

{
  "agentName": "æ™ºèƒ½å®¢æœAgent",
  "agentType": "LLM",
  "capabilities": {
    "supportedTasks": ["TEXT_ANALYSIS", "CUSTOMER_SERVICE"],
    "maxConcurrency": 10,
    "supportedLanguages": ["zh-CN", "en-US"]
  },
  "endpointUrl": "http://agent-service:8080/api",
  "authConfig": {
    "type": "API_KEY",
    "apiKey": "encrypted_key"
  }
}

Response 200:
{
  "code": 200,
  "message": "success",
  "data": {
    "agentId": "agent_1234567890",
    "status": "ACTIVE"
  }
}
```

### 5.3 MCPè¿æ¥API

#### 5.3.1 åˆ›å»ºMCPè¿æ¥
```http
POST /api/v1/mcp/connections
Content-Type: application/json

{
  "modelProvider": "ALIBABA",
  "modelName": "qwen-turbo",
  "endpointUrl": "https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation",
  "apiKey": "sk-xxxxxxxxxxxxx",
  "connectionConfig": {
    "maxTokens": 2000,
    "temperature": 0.8,
    "timeout": 30000
  }
}

Response 200:
{
  "code": 200,
  "message": "success",
  "data": {
    "connectionId": "conn_1234567890",
    "status": "CONNECTED"
  }
}
```

---

## 6. éƒ¨ç½²æ¶æ„è®¾è®¡

### 6.1 å¼€å‘ç¯å¢ƒ
```yaml
# docker-compose.dev.yml
version: '3.8'
services:
  app:
    build: .
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=dev
      - MYSQL_URL=jdbc:mysql://mysql:3306/ai_workflow
      - REDIS_URL=redis://redis:6379
    depends_on:
      - mysql
      - redis

  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: root123
      MYSQL_DATABASE: ai_workflow
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

volumes:
  mysql_data:
  redis_data:
```

### 6.2 ç”Ÿäº§ç¯å¢ƒ (Kubernetes)
```yaml
# k8s-deployment.yml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ai-workflow-app
spec:
  replicas: 3
  selector:
    matchLabels:
      app: ai-workflow
  template:
    metadata:
      labels:
        app: ai-workflow
    spec:
      containers:
      - name: app
        image: ai-workflow:latest
        ports:
        - containerPort: 8080
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "prod"
        - name: MYSQL_URL
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: mysql-url
        resources:
          requests:
            memory: "512Mi"
            cpu: "500m"
          limits:
            memory: "1Gi"
            cpu: "1000m"
---
apiVersion: v1
kind: Service
metadata:
  name: ai-workflow-service
spec:
  selector:
    app: ai-workflow
  ports:
  - port: 80
    targetPort: 8080
  type: LoadBalancer
```

---

## 7. å¼€å‘è®¡åˆ’

### 7.1 ç¬¬ä¸€é˜¶æ®µ (MVP - 4å‘¨)
- [ ] **Week 1**: é¡¹ç›®åŸºç¡€æ¶æ„æ­å»º
  - Spring Booté¡¹ç›®åˆå§‹åŒ–
  - æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡ä¸åˆ›å»º
  - åŸºç¡€çš„Controller/Service/Repositoryå±‚
  
- [ ] **Week 2**: MCPåè®®å¼•æ“æ ¸å¿ƒåŠŸèƒ½
  - MCPæœåŠ¡å™¨åŸºç¡€å®ç°
  - é˜¿é‡Œé€šä¹‰åƒé—®é€‚é…å™¨å¼€å‘
  - åŸºç¡€çš„å·¥å…·æ³¨å†Œå’Œç®¡ç†
  
- [ ] **Week 3**: æµç¨‹å¼•æ“æ ¸å¿ƒåŠŸèƒ½
  - ç®€å•çš„æµç¨‹å®šä¹‰å’Œè§£æ
  - åŸºç¡€ä»»åŠ¡è°ƒåº¦å™¨
  - Agentæ¥å£å’ŒLLM Agentå®ç°
  
- [ ] **Week 4**: ç³»ç»Ÿé›†æˆå’Œæµ‹è¯•
  - MCPå¼•æ“ä¸æµç¨‹å¼•æ“é›†æˆ
  - åŸºç¡€Webç•Œé¢å¼€å‘
  - ç«¯åˆ°ç«¯æµ‹è¯•ç”¨ä¾‹

### 7.2 ç¬¬äºŒé˜¶æ®µ (å®Œå–„åŠŸèƒ½ - 6å‘¨)
- [ ] **Week 5-6**: æµç¨‹è®¾è®¡å™¨å¼€å‘
  - å¯è§†åŒ–BPMNè®¾è®¡å™¨
  - æµç¨‹æ¨¡æ¿ç®¡ç†
  - æµç¨‹éªŒè¯å’Œæµ‹è¯•

- [ ] **Week 7-8**: é«˜çº§AgentåŠŸèƒ½
  - å¤šAgentåä½œæœºåˆ¶
  - Agentè´Ÿè½½å‡è¡¡
  - å¥åº·æ£€æŸ¥å’Œæ•…éšœæ¢å¤

- [ ] **Week 9-10**: ç›‘æ§å’Œè¿ç»´åŠŸèƒ½
  - å®æ—¶ç›‘æ§é¢æ¿
  - æ—¥å¿—åˆ†æå’ŒæŸ¥è¯¢
  - æ€§èƒ½æŒ‡æ ‡æ”¶é›†

### 7.3 ç¬¬ä¸‰é˜¶æ®µ (ä¼ä¸šçº§ç‰¹æ€§ - 4å‘¨)
- [ ] **Week 11-12**: å®‰å…¨å’Œæƒé™
  - ç”¨æˆ·è®¤è¯å’Œæˆæƒ
  - APIå®‰å…¨å’Œé™æµ
  - æ•°æ®åŠ å¯†å’Œéšç§ä¿æŠ¤

- [ ] **Week 13-14**: æ‰©å±•å’Œé›†æˆ
  - æ›´å¤šAIæ¨¡å‹é€‚é…å™¨
  - ç¬¬ä¸‰æ–¹å·¥å…·é›†æˆ
  - å¼€æ”¾APIå’ŒSDK

---

## 8. æ€»ç»“

æœ¬ç³»ç»Ÿè®¾è®¡ä»¥**MCPåè®®æ”¯æŒ**å’Œ**è‡ªç ”æµç¨‹ç¼–æ’å¼•æ“**ä¸ºæ ¸å¿ƒï¼Œæ„å»ºäº†ä¸€ä¸ªä¼ä¸šçº§çš„AIå·¥ä½œæµç¼–æ’å¹³å°ã€‚é€šè¿‡æ ‡å‡†åŒ–çš„MCPåè®®ï¼Œå®ç°äº†ä¸å¤šç§AIæ¨¡å‹çš„æ— ç¼é›†æˆï¼›é€šè¿‡çµæ´»çš„æµç¨‹å¼•æ“ï¼Œæä¾›äº†å¼ºå¤§çš„å¤šAgentåä½œèƒ½åŠ›ã€‚

**æ ¸å¿ƒæŠ€æœ¯äº®ç‚¹ï¼š**
1. ğŸ”— **MCPåè®®æ ‡å‡†åŒ–** - ç»Ÿä¸€AIæ¨¡å‹äº¤äº’æ¥å£
2. âš™ï¸ **è‡ªç ”æµç¨‹å¼•æ“** - çµæ´»çš„å·¥ä½œæµç¼–æ’èƒ½åŠ›  
3. ğŸ¤– **å¤šAgentåä½œ** - æ™ºèƒ½ä»»åŠ¡åˆ†é…å’Œåè°ƒ
4. ğŸš€ **ä¼ä¸šçº§éƒ¨ç½²** - é«˜å¯ç”¨ã€å¯æ‰©å±•çš„æ¶æ„è®¾è®¡

**å‘å±•è·¯çº¿ï¼š**
- çŸ­æœŸï¼šå®ç°MVPåŠŸèƒ½ï¼ŒéªŒè¯æ ¸å¿ƒæŠ€æœ¯æ–¹æ¡ˆ
- ä¸­æœŸï¼šå®Œå–„äº§å“åŠŸèƒ½ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- é•¿æœŸï¼šæ„å»ºå¼€æ”¾ç”Ÿæ€ï¼Œæˆä¸ºAIç¼–æ’æ ‡å‡†å¹³å°
